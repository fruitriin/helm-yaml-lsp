{{- if .Values.workflowTemplate.enabled }}
# ============================================================================
# WorkflowTemplate定義 - 再利用可能なテンプレート（Helm版）
# ============================================================================
#
# 【説明】
# - WorkflowTemplateは再利用可能なテンプレート定義
# - 他のWorkflowからtemplateRefで参照される
# - Helm includeで名前が解決される
#
# 【参照元】
# - workflow-templateref.yaml
# ============================================================================

apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: {{ include "argo-workflow-sample.fullname" . }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "argo-workflow-sample.labels" . | nindent 4 }}
spec:
  templates:
    # workflow-templateref.yamlから参照される
    - name: hello
      container:
        image: {{ .Values.workflow.image.repository }}:{{ .Values.workflow.image.tag }}
        command: [echo]
        args: ["{{ .Values.workflowTemplate.templates.hello.message }}"]

    - name: goodbye
      container:
        image: {{ .Values.workflow.image.repository }}:{{ .Values.workflow.image.tag }}
        command: [echo]
        args: ["Goodbye from Helm!"]
{{- end }}
